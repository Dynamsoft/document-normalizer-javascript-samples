<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="Quickly detect document boundaries from a live camera stream, show the boundaries in different styles depending on quality." />
    <meta name="keywords" content="document, detection, boundary, filter" />
    <title>Use filter to filter boundary results</title>
    <script src="https://npm.scannerproxy.com/cdn/@dynamsoft/dynamsoft-core@3.0.10-dev-20230811163138/dist/core.js"></script>
    <script src="https://npm.scannerproxy.com/cdn/@dynamsoft/utility@0.20230814110732.0/dist/utility.js"></script>
    <script src="https://npm.scannerproxy.com/cdn/@dynamsoft/ddnjs@0.20230811163831.0/dist/ddn.js"></script>
    <script src="https://npm.scannerproxy.com/cdn/@dynamsoft/cvrjs@0.20230815103342.0/dist/cvr.js"></script>
    <script src="https://npm.scannerproxy.com/cdn/@dynamsoft/dynamsoft-camera-enhancer@4.0.0-dev-20230811163231/dist/dce.js"></script>
</head>

<body>
    <button onclick="startDetecting()">Start Detecting</button>
    <br />
    <input type="checkbox" id="filter-verify" checked />
    <label for="filter-verify">Enable Result Cross-Verification</label>
    <br />
    <input type="checkbox" id="filter-duplication" />
    <label for="filter-duplication">Enable Result Deduplication</label>
    <br />
    <div id="div-ui-container" style="margin-top: 10px; height: 500px"></div>
    <script>
        /** LICENSE ALERT - README
         * To use the library, you need to first call the method initLicense() to initialize the license using a license key string.
         */
        Dynamsoft.License.LicenseManager.initLicense(
            "DLS2eyJvcmdhbml6YXRpb25JRCI6IjIwMDAwMSJ9"
        );
        /**
         * The license "DLS2eyJvcmdhbml6YXRpb25JRCI6IjIwMDAwMSJ9" is a temporary license for testing good for 24 hours.
         * You can visit https://www.dynamsoft.com/customer/license/trialLicense?utm_source=github&architecture=dcv&product=ddn&package=js to get your own trial license good for 30 days.
         * LICENSE ALERT - THE END
         */

        /**
         * Preloads the `DocumentNormalizer` module, saving time in preparing for document border detection and image normalization.
         */
        Dynamsoft.CVR.CaptureVisionRouter.preloadModule(["DDN"]);

        let promiseCVRReady;
        let cameraEnhancer;
        let view;
        let router;
        let filter;
        const cameraViewContainer = document.querySelector("#div-ui-container");
        const filterVerify = document.querySelector("#filter-verify");
        const filterDuplication = document.querySelector("#filter-duplication");

        /**
         * Creates a CameraEnhancer instance to stream the video and draw found boundaries.
         */
        async function initDCE() {
            view = await Dynamsoft.DCE.CameraView.createInstance();
            cameraEnhancer = await Dynamsoft.DCE.CameraEnhancer.createInstance(
                view
            );
            cameraViewContainer.append(view.getUIElement());
        }

        let cvrReady = (async function initCVR() {
            await initDCE();
            router = await Dynamsoft.CVR.CaptureVisionRouter.createInstance();
            router.setInput(cameraEnhancer);
            cameraViewContainer.append(view.getUIElement());

            const resultReceiver = new Dynamsoft.CVR.CapturedResultReceiver();

            resultReceiver.onCapturedResultReceived = (result) => {
                /* Do something with the result */
            };

            /* Defines the result receiver for the task.*/
            router.addResultReceiver(resultReceiver);

            /**
             * Specifies a result filter.
             *
             * NOTE that you must import dynamsoft-utility.js to use MultiFrameResultCrossFilter.
             */
            filter = new Dynamsoft.Utility.MultiFrameResultCrossFilter();
            /* Enables result cross-verification.*/
            filter.enableResultCrossVerification(
                Dynamsoft.Core.EnumCapturedResultItemType.CRIT_DETECTED_QUAD,
                true
            );
            /* Disables result deduplication. */
            filter.enableResultDeduplication(
                Dynamsoft.Core.EnumCapturedResultItemType.CRIT_DETECTED_QUAD,
                false
            );
            await router.addResultFilter(filter);
            filterVerify.checked = true;
            filterDuplication.checked = false;
        })();

        async function startDetecting() {
            try {
                await (promiseCVRReady =
                    promiseCVRReady ||
                    (async() => {
                        await cvrReady;
                        /* Starts streaming the video. */
                        await cameraEnhancer.open();
                        /* Uses the built-in template "detect-document-boundaries" to start a boundary detection task. */
                        await router.startCapturing("detect-document-boundaries");
                    })());
            } catch (ex) {}
        }

        /**
         * Updates the filter based on user input.
         */
        filterVerify.addEventListener("change", () => {
            if (!filter) return;
            filter.enableResultCrossVerification(
                Dynamsoft.Core.EnumCapturedResultItemType.CRIT_DETECTED_QUAD,
                filterVerify.checked
            );
        });

        filterDuplication.addEventListener("change", () => {
            if (!filter) return;
            filter.enableResultDeduplication(
                Dynamsoft.Core.EnumCapturedResultItemType.CRIT_DETECTED_QUAD,
                filterDuplication.checked
            );
        });
    </script>
</body>

</html>