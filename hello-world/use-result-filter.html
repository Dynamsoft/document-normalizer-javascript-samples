<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description"
        content="Quickly detect document boundaries from a live camera stream and crop the document out before normalizing it further through perspective correction, deskewing, and more.">
    <meta name="keywords" content="camera based quadrilateral detection and normalization">
    <title>Use filter to filter boundary results</title>
    <script
        src="https://npm.scannerproxy.com/cdn/@dynamsoft/dynamsoft-core@3.0.10-dev-20230811163138/dist/core.js"></script>
    <script src="https://npm.scannerproxy.com/cdn/@dynamsoft/utility@0.20230814110732.0/dist/utility.js"></script>
    <script src="https://npm.scannerproxy.com/cdn/@dynamsoft/cvrjs@0.20230815103342.0/dist/cvr.js"></script>
    <script
        src="https://npm.scannerproxy.com/cdn/@dynamsoft/dynamsoft-camera-enhancer@4.0.0-dev-20230811163231/dist/dce.js"></script>
</head>

<body>
    <button onclick="startDetecting()">Start Detecting</button><br>
    <input type="checkbox" id="filter-verify" checked><label for="filter-verify">Enable Result Cross-Verification</label>
    <input type="checkbox" id="filter-duplication"><label for="filter-duplication">Enable Result Deduplication</label>
    <div id="div-ui-container" style="margin-top: 10px;height: 500px;"></div>
    <script>
        /** LICENSE ALERT - README
        * To use the library, you need to first specify a license key using the API "license" as shown below.
        */
        Dynamsoft.License.LicenseManager.initLicense("DLS2eyJvcmdhbml6YXRpb25JRCI6IjIwMDAwMSJ9");
        /**
         * You can visit https://www.dynamsoft.com/customer/license/trialLicense?utm_source=github&architecture=dcv&product=ddn&package=js to get your own trial license good for 30 days.
         * For more information, see https://dynamsoft.com/document-normalizer/docs/web/programming/javascript/user-guide/?ver=2.0.10&utm_source=github#configure-the-license or contact support@dynamsoft.com.
         * LICENSE ALERT - THE END
        */

        Dynamsoft.CVR.CaptureVisionRouter.preloadModule(["DDN"]);

        let promiseCVRReady;
        let cameraEnhancer;
        let view;
        let router;
        let filter;
        const cameraViewContainer = document.querySelector("#div-ui-container");
        const filterVerify = document.querySelector("#filter-verify");
        const filterDuplication = document.querySelector("#filter-duplication");

        async function initDCE() {
            view = await Dynamsoft.DCE.CameraView.createInstance();
            cameraEnhancer = await Dynamsoft.DCE.CameraEnhancer.createInstance(view);
            cameraViewContainer.append(view.getUIElement());
        }

        let cvrReady = (async function initCVR() {
            await initDCE();
            router = await Dynamsoft.CVR.CaptureVisionRouter.createInstance();
            router.setInput(cameraEnhancer);
            cameraViewContainer.append(view.getUIElement());

            const resultReceiver = new Dynamsoft.CVR.CapturedResultReceiver();

            resultReceiver.onCapturedResultReceived = (result) => {
                console.log(result.items);
            };

            /* Specifiy the result receiver */
            router.addResultReceiver(resultReceiver);

            /* Specifiy the result filter, to use filter, you need to import dynamsoft-utility.js */
            filter = new Dynamsoft.Utility.MultiFrameResultCrossFilter();
            filter.enableResultCrossVerification(Dynamsoft.Core.EnumCapturedResultItemType.CRIT_DETECTED_QUAD, true);
            filter.enableResultDeduplication(Dynamsoft.Core.EnumCapturedResultItemType.CRIT_DETECTED_QUAD, false);
            await router.addResultFilter(filter);
            filterVerify.checked = true;
            filterDuplication.checked = false;
        })();

        async function startDetecting() {
            try {
                await (promiseCVRReady = promiseCVRReady || (async () => {
                    await cvrReady;
                    /* Start streaming the video */
                    await cameraEnhancer.open();
                    /* Use the built-in template "detect-document-boundaries" to start a boundary detecting task */
                    await router.startCapturing("detect-document-boundaries");
                })())
            } catch (ex) {

            }
        }
        
        filterVerify.addEventListener("change", () => {
            if(!filter) return;
            filter.enableResultCrossVerification(Dynamsoft.Core.EnumCapturedResultItemType.CRIT_DETECTED_QUAD, filterVerify.checked);
        })
        
        filterDuplication.addEventListener("change", () => {
            if(!filter) return;
            filter.enableResultDeduplication(Dynamsoft.Core.EnumCapturedResultItemType.CRIT_DETECTED_QUAD, filterDuplication.checked);
        })
    </script>
</body>

</html>